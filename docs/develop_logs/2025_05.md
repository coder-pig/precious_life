## 1. 集成 geolocator 库获取定位的问题

### Android端

**问题描述**

一直获取不到定位信息，并出现警告：W/GooglePlayServicesUtil(7067): com.example.precious_life requires the Google Play Store, but it is missing.

**问题解决**

需要渐进做下异常处理：定位服务是否可用，权限检查，然后不同平台执行特定配置，对定位异常进行捕获，尝试getLastKnownPosition()获取上次已知位置。

### iOS端

**问题描述**

> 一直报某些Channel方法没有实现

**问题解决**

> 添加 geolocator_apple: ^2.3.9 特定平台实现

---

## 2. freezed 反序列化字段丢失

> 使用@freezed定义实体类，发现在转换成对象时有些字段会丢失值，明明字段类型都是对的：

```dart
/// 类
@freezed
class QweatherNow with _$QweatherNow {
  const factory QweatherNow({
    /// 数据观测时间
    String? obsTime,

    /// 温度，默认单位：摄氏度
    String? temp,

    /// 体感温度，默认单位：摄氏度
    String? feelsLike,

    /// 天气状况的图标代码
    String? icon,

    /// 天气状况的文字描述，包括阴晴雨雪等天气状态的描述
    String? text,

    /// 风向360角度
    String? wind360,

    /// 风向
    String? windDir,

    /// 风力等级
    String? windScale,

    /// 风速，公里/小时
    String? windSpeed,

    /// 相对湿度，百分比数值
    String? humidity,

    /// 过去1小时降水量，默认单位：毫米
    String? precip,

    /// 大气压强，默认单位：百帕
    String? pressure,

    /// 能见度，默认单位：公里
    String? vis,

    /// 云量，百分比数值。可能为空
    String? cloud,

    /// 露点温度。可能为空
    String? dew,
  }) = _QweatherNow;

  factory QweatherNow.fromJson(Map<String, dynamic> json) => _$QweatherNowFromJson(json);
}

/// 打印生成对象的值
weatherData.now QweatherNow(obsTime: null, temp: 32, feelsLike: null, icon: 100, text: 晴, wind360: 200, windDir: null, windScale: null, windSpeed: null, humidity: 63, precip: 0.0, pressure: 1001, vis: null, cloud: 22, dew: 24)

/// 后台接口返回的数据
{"obsTime":"2025-05-22T07:00+00:00","temp":"32","feelsLike":"33","icon":"100","text":"晴","wind360":"200","windDir":"西南偏南风","windScale":"3","windSpeed":"17","humidity":"63","precip":"0.0","pressure":"1001","cloud":"22","dew":"24"}
```

**问题解决**

> 🐶 AI 生成的 build.yaml 中关于 json_serializable 库的配置，加了一个【field_rename: snake】，它会：自动把 Dart 类的字段名（通常是驼峰命名法，比如 obsTime、feelsLike）在序列化和反序列化 JSON 时，转换为 蛇形命名（比如 obs_time、feels_like），有毒，我擦。